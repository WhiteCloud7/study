"use strict";(self["webpackChunkblog"]=self["webpackChunkblog"]||[]).push([[371],{2371:function(e,n,t){t.r(n),t.d(n,{default:function(){return f}});t(4114);var o=t(6436),i=t(5167),r=t(3229),a=t(9241),l=t(5032);const u={class:"myArticles-articleEdit"},c={class:"myArticles-editContent"},d={class:"myArticles-editButtonGroup"};var s={__name:"editArticle",props:{articleId:Number},setup(e){const n=e,t=(0,r.rd)(),s=(0,i.KR)(),p=(0,i.KR)(),f=(0,i.KR)(!0),v=(0,i.KR)("default"),m=(0,i.KR)(!1),g=(0,r.lq)();function y(){f.value=!f.value,v.value=f.value?"default":"text"}function h(e){e=e.replace(/<p[^>]*>/gi,"").replace(/<\/p>/gi,"\r\n"),e=e.replace(/<br\s*\/?>/gi,"\r\n");const n=document.createElement("div");return n.innerHTML=e,n.innerText}function C(){if("/article/add"!==g.path){const e=new URLSearchParams;e.append("articleId",n.articleId),e.append("title",s.value),e.append("content",h(p.value)),l.A.post("http://localhost:8081/saveArticle",e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{confirm("保存成功！"),window.location.reload()})).catch((e=>{console.error(e)}))}else{const e=new URLSearchParams;e.append("title",s.value),e.append("content",h(p.value)),l.A.post("http://localhost:8081/saveArticleToDraft",e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{confirm("保存成功！")})).catch((e=>{console.error(e)}))}}function b(){const e=new URLSearchParams;e.append("title",s.value),e.append("content",h(p.value)),l.A.post("http://localhost:8081/newArticle",e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{confirm("发布成功！"),t.push("/article")})).catch((e=>{console.error(e)}))}function w(){"/article/add"!==g.path?l.A.get("http://localhost:8081/initCurrentArticle",{params:{articleId:n.articleId},responseType:"json"}).then((e=>{const n=e.data.data;s.value=n.title,p.value="undefined"===p.value?"":n.articleContent.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>")})).catch((e=>{console.log(e)})):S()}function S(){l.A.get("http://localhost:8081/articleDraft").then((e=>{const n=e.data.data;s.value="undefined"===n.title?"":n.title,p.value=void 0===n.articleContent?"":n.articleContent})).catch(console.log)}function A(){m.value=!0,setTimeout((()=>{m.value=!1}),1e3)}function k(){t.push("/article")}return(0,o.sV)((()=>{w(),A()})),(e,n)=>{const t=(0,o.g2)("el-input"),r=(0,o.g2)("el-button"),l=(0,o.gN)("loading");return(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",u,[(0,o.Lk)("div",c,[(0,o.bF)(t,{type:"text",modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=e=>s.value=e),readonly:f.value,placeholder:"请输入标题","input-style":{cursor:v.value}},null,8,["modelValue","readonly","input-style"]),(0,o.bF)((0,i.R1)(a.A),{"api-key":"lifs7sk02yr110bbdvq7tcxiwlnr1p29cqe9sz0j1do78teq",modelValue:p.value,"onUpdate:modelValue":n[1]||(n[1]=e=>p.value=e),init:{height:480,resize:!1,menubar:!1,plugins:"link image code lists",toolbar:"undo redo | bold italic | alignleft aligncenter alignright | bullist numlist | code",placeholder:"请输入正文内容",branding:!1,promotion:!1,readonly:f.value}},null,8,["modelValue","init"])]),(0,o.Lk)("div",d,[(0,o.bF)(r,{class:"myArticles-editButton",onClick:y},{default:(0,o.k6)((()=>n[2]||(n[2]=[(0,o.eW)("编辑")]))),_:1}),(0,o.bF)(r,{class:"myArticles-editButton",onClick:C},{default:(0,o.k6)((()=>n[3]||(n[3]=[(0,o.eW)("保存")]))),_:1}),"/add"===(0,i.R1)(g).path.slice((0,i.R1)(g).path.lastIndexOf("/"))?((0,o.uX)(),(0,o.Wv)(r,{key:0,class:"myArticles-editButton",onClick:b},{default:(0,o.k6)((()=>n[4]||(n[4]=[(0,o.eW)("发布")]))),_:1})):(0,o.Q3)("",!0),(0,o.bF)(r,{class:"myArticles-editButton",onClick:k},{default:(0,o.k6)((()=>n[5]||(n[5]=[(0,o.eW)("返回")]))),_:1})])])),[[l,m.value,void 0,{fullscreen:!0,lock:!0}]])}}};const p=s;var f=p},9241:function(e,n,t){t.d(n,{A:function(){return E}});t(4114),t(8111),t(7588),t(2489);var o=t(6436),i=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],r=function(e){return-1!==i.map((function(e){return e.toLowerCase()})).indexOf(e.toLowerCase())},a=function(e,n,t){Object.keys(n).filter(r).forEach((function(o){var i=n[o];"function"===typeof i&&("onInit"===o?i(e,t):t.on(o.substring(2),(function(e){return i(e,t)})))}))},l=function(e,n,t,i){var r=e.modelEvents?e.modelEvents:null,a=Array.isArray(r)?r.join(" "):r;(0,o.wB)(i,(function(n,o){t&&"string"===typeof n&&n!==o&&n!==t.getContent({format:e.outputFormat})&&t.setContent(n)})),t.on(a||"change input undo redo",(function(){n.emit("update:modelValue",t.getContent({format:e.outputFormat}))}))},u=function(e,n,t,o,i,r){o.setContent(r()),t.attrs["onUpdate:modelValue"]&&l(n,t,o,i),a(e,t.attrs,o)},c=0,d=function(e){var n=Date.now(),t=Math.floor(1e9*Math.random());return c++,e+"_"+t+c+String(n)},s=function(e){return null!==e&&"textarea"===e.tagName.toLowerCase()},p=function(e){return"undefined"===typeof e||""===e?[]:Array.isArray(e)?e:e.split(" ")},f=function(e,n){return p(e).concat(p(n))},v=function(e){return null===e||void 0===e},m=function(){return{listeners:[],scriptId:d("tiny-script"),scriptLoaded:!1}},g=function(){var e=m(),n=function(e,n,t,o){var i=n.createElement("script");i.referrerPolicy="origin",i.type="application/javascript",i.id=e,i.src=t;var r=function(){i.removeEventListener("load",r),o()};i.addEventListener("load",r),n.head&&n.head.appendChild(i)},t=function(t,o,i){e.scriptLoaded?i():(e.listeners.push(i),t.getElementById(e.scriptId)||n(e.scriptId,t,o,(function(){e.listeners.forEach((function(e){return e()})),e.scriptLoaded=!0})))},o=function(){e=m()};return{load:t,reinitialize:o}},y=g(),h=function(){return"undefined"!==typeof window?window:t.g},C=function(){var e=h();return e&&e.tinymce?e.tinymce:null},b={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return"html"===e||"text"===e}}},w=t(5167),S=function(){return S=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e},S.apply(this,arguments)},A=function(e,n,t,o){return e(o||"div",{id:n,ref:t})},k=function(e,n,t){return e("textarea",{id:n,visibility:"hidden",ref:t})},R={selector:void 0,target:void 0},B=(0,o.pM)({props:b,setup:function(e,n){var t=e.init?S(S({},e.init),R):S({},R),i=(0,w.QW)(e),r=i.disabled,a=i.modelValue,l=i.tagName,c=(0,w.KR)(null),p=null,m=e.id||d("tiny-vue"),g=e.init&&e.init.inline||e.inline,h=!!n.attrs["onUpdate:modelValue"],b=!0,B=e.initialValue?e.initialValue:"",E="",x=function(e){return h?function(){return(null===a||void 0===a?void 0:a.value)?a.value:""}:function(){return e?B:E}},D=function(){var o=x(b),i=S(S({},t),{readonly:e.disabled,target:c.value,plugins:f(t.plugins,e.plugins),toolbar:e.toolbar||t.toolbar,inline:g,license_key:e.licenseKey,setup:function(i){p=i,i.on("init",(function(t){return u(t,e,n,i,a,o)})),"function"===typeof t.setup&&t.setup(i)}});s(c.value)&&(c.value.style.visibility=""),C().init(i),b=!1};(0,o.wB)(r,(function(e){var n;null!==p&&("function"===typeof(null===(n=p.mode)||void 0===n?void 0:n.set)?p.mode.set(e?"readonly":"design"):p.setMode(e?"readonly":"design"))})),(0,o.wB)(l,(function(e){var n;h||(E=p.getContent()),null===(n=C())||void 0===n||n.remove(p),(0,o.dY)((function(){return D()}))})),(0,o.sV)((function(){if(null!==C())D();else if(c.value&&c.value.ownerDocument){var n=e.cloudChannel?e.cloudChannel:"7",t=e.apiKey?e.apiKey:"no-api-key",o=v(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(t,"/tinymce/").concat(n,"/tinymce.min.js"):e.tinymceScriptSrc;y.load(c.value.ownerDocument,o,D)}})),(0,o.xo)((function(){null!==C()&&C().remove(p)})),g||((0,o.n)((function(){b||D()})),(0,o.Y4)((function(){var e;h||(E=p.getContent()),null===(e=C())||void 0===e||e.remove(p)})));var V=function(e){var n;E=p.getContent(),null===(n=C())||void 0===n||n.remove(p),t=S(S(S({},t),e),R),(0,o.dY)((function(){return D()}))};return n.expose({rerender:V,getEditor:function(){return p}}),function(){return g?A(o.h,m,c,e.tagName):k(o.h,m,c)}}}),E=B}}]);
//# sourceMappingURL=371.51459000.js.map