{"version":3,"file":"js/788.a701ce88.js","mappings":"4iBAsEA,MAAMA,GAASC,EAAAA,EAAAA,IAAI,IACbC,GAAWD,EAAAA,EAAAA,IAAI,IACfE,GAAMF,EAAAA,EAAAA,IAAI,IACVG,GAAMH,EAAAA,EAAAA,IAAI,IACVI,GAAWJ,EAAAA,EAAAA,IAAI,IACfK,GAAQL,EAAAA,EAAAA,IAAI,IACZM,GAAKN,EAAAA,EAAAA,IAAI,IACTO,GAASP,EAAAA,EAAAA,IAAI,IACbQ,GAASR,EAAAA,EAAAA,IAAI,IAGbS,GAAmBT,EAAAA,EAAAA,IAAI,IACvBU,GAAcV,EAAAA,EAAAA,IAAI,IAClBW,GAAmBX,EAAAA,EAAAA,IAAI,IACvBY,GAAgBZ,EAAAA,EAAAA,IAAI,IACpBa,GAAab,EAAAA,EAAAA,IAAI,IACjBc,GAAiBd,EAAAA,EAAAA,IAAI,IACrBe,GAA2Bf,EAAAA,EAAAA,IAAI,IAC/BgB,GAASC,EAAAA,EAAAA,MAGf,SAASC,EAAaC,GACpB,MAAMC,EAAY,IAAIC,KAAKF,GACrBG,EAAc,IAAID,KACxB,IAAIE,EAAgBD,EAAYE,cAAgBJ,EAAUI,cAC1D,MAAMC,EAAYH,EAAYI,WAAaN,EAAUM,WAIrD,OAHID,EAAY,GAAoB,IAAdA,GAAmBH,EAAYK,UAAYP,EAAUO,YACzEJ,IAEKA,CACT,CAEA,SAASK,IACPC,EAAAA,EAAMC,IAAI,gCAAiC,CACzCC,aAAc,SACbC,MAAKC,IACN,MAAMC,EAAOD,EAAIC,KAAKA,KACtBnC,EAAOoC,MAAQD,EAAKE,WACpBnC,EAASkC,MAAQD,EAAKG,SACtBnC,EAAIiC,MAAQD,EAAKhC,IACjBE,EAAS+B,MAAQD,EAAK9B,SACtBC,EAAM8B,MAAQD,EAAK7B,MACnBC,EAAG6B,MAAQD,EAAK5B,GAChBC,EAAO4B,MAAQD,EAAK3B,OACpBC,EAAO2B,MAAQD,EAAK1B,OAEpBL,EAAIgC,MAAQjB,EAAad,EAAS+B,OAGlC1B,EAAiB0B,MAAQlC,EAASkC,MAClCzB,EAAYyB,MAAQjC,EAAIiC,MACxBxB,EAAiBwB,MAAQ/B,EAAS+B,MAClCvB,EAAcuB,MAAQ9B,EAAM8B,MAC5BtB,EAAWsB,MAAQ7B,EAAG6B,MACtBrB,EAAeqB,MAAQ5B,EAAO4B,MAC9BpB,EAAyBoB,MAAQ3B,EAAO2B,KAAK,IAC5CG,OAAMC,IACPC,QAAQC,IAAIF,EAAI,GAEpB,CAcA,SAASG,IACPb,EAAAA,EAAMc,KAAK,oCAAqC,CAC9CN,SAAUpC,EAASkC,MACnBjC,IAAKA,EAAIiC,MACT/B,SAA2B,OAAjBA,EAAS+B,MAAa,KAAK/B,EAAS+B,MAAMS,iBACpDvC,MAAOA,EAAM8B,MACb7B,GAAIA,EAAG6B,MACP5B,OAAQA,EAAO4B,MACf3B,OAAQA,EAAO2B,MACfpC,OAAQA,EAAOoC,QACdH,MAAKC,IACa,YAAhBA,EAAIC,KAAKA,KACVW,MAAM,WAENA,MAAM,SAAS,IAChBP,OAAMC,IACPC,QAAQC,IAAIF,GACZM,MAAM,eAAe,GAEzB,CAGA,SAASC,IACP7C,EAASkC,MAAQ1B,EAAiB0B,MAClCjC,EAAIiC,MAAQzB,EAAYyB,MACxB/B,EAAS+B,MAAQxB,EAAiBwB,MAClC9B,EAAM8B,MAAQvB,EAAcuB,MAC5B7B,EAAG6B,MAAQtB,EAAWsB,MACtB5B,EAAO4B,MAAQrB,EAAeqB,MAC9B3B,EAAO2B,MAAQpB,EAAyBoB,MACxCnB,EAAO+B,KAAK,WACd,EA3CAC,EAAAA,EAAAA,KAAU,KACRpB,GAAa,KAIfqB,EAAAA,EAAAA,IAAM7C,GAAW8C,IACXA,IACF/C,EAAIgC,MAAQjB,EAAagC,GAC3B,IAsCF,MAAMC,EAAuBlB,IACb,WAAXA,EAAIC,KACLW,MAAM,WACW,SAAXZ,EAAIC,KACVW,MAAM,UAEN9C,EAAOoC,MAAQF,EAAIC,KAAKkB,WACxBP,MAAM,WACR,EAIIQ,EAAsBC,IAC1B,MAAMC,EAA2B,eAAdD,EAAKE,MAAuC,cAAdF,EAAKE,KACtD,IAAKD,EAEH,OADAV,MAAM,uBACC,EAET,MAAMY,EAASH,EAAKI,KAAO,KAAO,KAAO,EACzC,OAAKD,EAIEF,GAAcE,GAHnBZ,MAAM,iBACC,EAEkB,EAGvBc,EAAgB,CAAEC,cAAe,UAAUC,eAAeC,QAAQ,Y,omFCrMxE,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://blog/./src/components/profile/profileSetting.vue","webpack://blog/./src/components/profile/profileSetting.vue?e18e"],"sourcesContent":["<template>\r\n  <div class=\"edit-profile-content\">\r\n    <h1>编辑资料</h1>\r\n    <form @submit.prevent=\"saveProfile\">\r\n      <div class=\"profile-avatar\">\r\n        <span style=\"position: relative;top: 8px\">头像:</span>\r\n        <el-avatar :src=\"avatar\" size=\"100\" style=\"margin-left: 48px\"></el-avatar>\r\n        <el-upload\r\n            class=\"avatar-uploader\"\r\n            action=\"http://localhost:8081/api/uploadAvatar\"\r\n            :show-file-list=\"false\"\r\n            :on-success=\"handleAvatarSuccess\"\r\n            :headers=\"uploadHeaders\"\r\n            :before-upload=\"beforeAvatarUpload\"\r\n        >\r\n          <i class=\"el-icon-upload\"></i>\r\n          <el-button style=\"margin-left: 20px\">点击上传</el-button>\r\n        </el-upload>\r\n      </div>\r\n      <div class=\"profile-item\">\r\n        <span>昵称:</span>\r\n        <el-input v-model=\"nickname\" placeholder=\"请输入昵称\"></el-input>\r\n      </div>\r\n      <div class=\"profile-item\">\r\n        <span>性别:</span>\r\n        <el-select v-model=\"sex\" placeholder=\"请选择性别\">\r\n          <el-option label=\"男\" value=\"男\"></el-option>\r\n          <el-option label=\"女\" value=\"女\"></el-option>\r\n        </el-select>\r\n      </div>\r\n      <div class=\"profile-item\">\r\n        <span>生日:</span>\r\n        <el-date-picker\r\n            v-model=\"birthday\"\r\n            type=\"date\"\r\n            placeholder=\"选择生日\"\r\n        ></el-date-picker>\r\n        <!-- 年龄根据生日自动计算，不提供编辑 -->\r\n        <span style=\"margin-left: 10px\">年龄:</span>\r\n        <span>{{ age }}</span>\r\n      </div>\r\n      <div class=\"profile-item\">\r\n        <span>电话:</span>\r\n        <el-input v-model=\"phone\" placeholder=\"请输入电话号码\"></el-input>\r\n      </div>\r\n      <div class=\"profile-item\">\r\n        <span>QQ:</span>\r\n        <el-input v-model=\"qq\" placeholder=\"请输入 QQ 号\"></el-input>\r\n      </div>\r\n      <div class=\"profile-item\">\r\n        <span>微信:</span>\r\n        <el-input v-model=\"wechat\" placeholder=\"请输入微信号\"></el-input>\r\n      </div>\r\n      <div class=\"profile-item\">\r\n        <span>毕业院校:</span>\r\n        <el-input v-model=\"school\" placeholder=\"请输入毕业院校\"></el-input>\r\n      </div>\r\n      <div class=\"button-group\" style=\"margin-left: 160px\">\r\n        <el-button type=\"primary\" @click=\"saveProfile\" style=\"margin-right: 40px\">保存</el-button>\r\n        <el-button @click=\"cancelEdit\">取消</el-button>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, ref, watch } from \"vue\";\r\nimport axios from '@/axios';\r\nimport {useRouter} from \"vue-router\";\r\n\r\nconst avatar = ref('');\r\nconst nickname = ref('');\r\nconst sex = ref('');\r\nconst age = ref('');\r\nconst birthday = ref('');\r\nconst phone = ref('');\r\nconst qq = ref('');\r\nconst wechat = ref('');\r\nconst school = ref('');\r\n\r\n// 保存原始数据，用于取消编辑时恢复\r\nconst originalNickname = ref('');\r\nconst originalSex = ref('');\r\nconst originalBirthday = ref('');\r\nconst originalPhone = ref('');\r\nconst originalQQ = ref('');\r\nconst originalWechat = ref('');\r\nconst originalGraduationSchool = ref('');\r\nconst router = useRouter();\r\n\r\n// 计算年龄的函数\r\nfunction calculateAge(birthdayStr) {\r\n  const birthDate = new Date(birthdayStr);\r\n  const currentDate = new Date();\r\n  let calculatedAge = currentDate.getFullYear() - birthDate.getFullYear();\r\n  const monthDiff = currentDate.getMonth() - birthDate.getMonth();\r\n  if (monthDiff < 0 || (monthDiff === 0 && currentDate.getDate() < birthDate.getDate())) {\r\n    calculatedAge--;\r\n  }\r\n  return calculatedAge;\r\n}\r\n\r\nfunction initProfile() {\r\n  axios.get(\"http://localhost:8081/profile\", {\r\n    responseType: \"json\"\r\n  }).then(res => {\r\n    const data = res.data.data;\r\n    avatar.value = data.avatar_src;\r\n    nickname.value = data.nikeName;\r\n    sex.value = data.sex;\r\n    birthday.value = data.birthday;\r\n    phone.value = data.phone;\r\n    qq.value = data.qq;\r\n    wechat.value = data.wechat;\r\n    school.value = data.school;\r\n    // 初始化年龄\r\n    age.value = calculateAge(birthday.value);\r\n\r\n    // 保存原始数据\r\n    originalNickname.value = nickname.value;\r\n    originalSex.value = sex.value;\r\n    originalBirthday.value = birthday.value;\r\n    originalPhone.value = phone.value;\r\n    originalQQ.value = qq.value;\r\n    originalWechat.value = wechat.value;\r\n    originalGraduationSchool.value = school.value;\r\n  }).catch(err => {\r\n    console.log(err);\r\n  });\r\n}\r\n\r\nonMounted(() => {\r\n  initProfile();\r\n});\r\n\r\n// 监控生日变化，实时更新年龄\r\nwatch(birthday, (newBirthday) => {\r\n  if (newBirthday) {\r\n    age.value = calculateAge(newBirthday);\r\n  }\r\n});\r\n\r\n// 保存资料\r\nfunction saveProfile() {\r\n  axios.post(\"http://localhost:8081/saveProfile\", {\r\n    nikeName: nickname.value,\r\n    sex: sex.value,\r\n    birthday: birthday.value===null?null:birthday.value.toLocaleString(),\r\n    phone: phone.value,\r\n    qq: qq.value,\r\n    wechat: wechat.value,\r\n    school: school.value,\r\n    avatar: avatar.value\r\n  }).then(res => {\r\n    if(res.data.data===\"昵称已被使用！\")\r\n      alert(\"昵称已被使用！\")\r\n    else\r\n      alert('资料保存成功');\r\n  }).catch(err => {\r\n    console.log(err);\r\n    alert('资料保存失败，请稍后重试');\r\n  });\r\n}\r\n\r\n// 取消编辑\r\nfunction cancelEdit() {\r\n  nickname.value = originalNickname.value;\r\n  sex.value = originalSex.value;\r\n  birthday.value = originalBirthday.value;\r\n  phone.value = originalPhone.value;\r\n  qq.value = originalQQ.value;\r\n  wechat.value = originalWechat.value;\r\n  school.value = originalGraduationSchool.value;\r\n  router.push(\"/profile\");\r\n}\r\n\r\n// 处理头像上传成功\r\nconst handleAvatarSuccess = (res) => {\r\n  if(res.data===\"上传文件为空\")\r\n    alert(\"上传文件为空!\");\r\n  else if(res.data===\"上传失败\")\r\n    alert(\"上传失败!\");\r\n  else{\r\n    avatar.value = res.data.avatar_url;\r\n    alert('头像上传成功!');\r\n  }\r\n};\r\n\r\n// 上传头像前的钩子\r\nconst beforeAvatarUpload = (file) => {\r\n  const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png';\r\n  if (!isJpgOrPng) {\r\n    alert('只能上传 JPG/PNG 格式的图片');\r\n    return false;\r\n  }\r\n  const isLt2M = file.size / 1024 / 1024 < 2;\r\n  if (!isLt2M) {\r\n    alert('图片大小不能超过 2MB');\r\n    return false;\r\n  }\r\n  return isJpgOrPng && isLt2M;\r\n};\r\n\r\nconst uploadHeaders = { Authorization: `Bearer ${sessionStorage.getItem('token')}`};\r\n</script>\r\n\r\n<style scoped>\r\n.edit-profile-content {\r\n  width: 600px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-items: center;\r\n  align-items: center;\r\n}\r\n\r\n.profile-item {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.profile-item span {\r\n  width: 100px;\r\n}\r\n\r\n.button-group {\r\n  margin-top: 20px;\r\n}\r\n\r\n.avatar-uploader .el-upload {\r\n  border: 1px dashed #d9d9d9;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.avatar-uploader .el-upload:hover {\r\n  border-color: #409EFF;\r\n}\r\n\r\n.avatar-uploader-icon {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 100px;\r\n  height: 100px;\r\n  line-height: 100px;\r\n  text-align: center;\r\n}\r\n\r\n.avatar {\r\n  width: 100px;\r\n  height: 100px;\r\n  display: block;\r\n}\r\n\r\n.profile-avatar{\r\n  display: flex;\r\n  flex-direction: row;\r\n  margin-right: 10px;\r\n  margin-bottom: 10px;\r\n  margin-top: 20px;\r\n}\r\n</style>","import script from \"./profileSetting.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./profileSetting.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./profileSetting.vue?vue&type=style&index=0&id=28a1972a&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-28a1972a\"]])\n\nexport default __exports__"],"names":["avatar","ref","nickname","sex","age","birthday","phone","qq","wechat","school","originalNickname","originalSex","originalBirthday","originalPhone","originalQQ","originalWechat","originalGraduationSchool","router","useRouter","calculateAge","birthdayStr","birthDate","Date","currentDate","calculatedAge","getFullYear","monthDiff","getMonth","getDate","initProfile","axios","get","responseType","then","res","data","value","avatar_src","nikeName","catch","err","console","log","saveProfile","post","toLocaleString","alert","cancelEdit","push","onMounted","watch","newBirthday","handleAvatarSuccess","avatar_url","beforeAvatarUpload","file","isJpgOrPng","type","isLt2M","size","uploadHeaders","Authorization","sessionStorage","getItem","__exports__"],"sourceRoot":""}